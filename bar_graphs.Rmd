---
title: Time charts for observed lessons
author: Saurabh Khanna 
date: "`r Sys.Date()`"
output: 
  github_document:
    toc: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r message=FALSE, warning=FALSE}
# Libraries
library(tidyverse)
```

# Time charts
## Reading in data

```{r}
df <-
  tribble(
    ~school, ~teacher, ~act,                   ~time,
    
    "S1",    "T1",     "Warm up",              4,
    "S1",    "T1",     "Lesson launch",        9,
    "S1",    "T1",     "Student group work",   24,
    "S1",    "T1",     "Class discussion",     5,
    "S1",    "T1",     "Transitions",          3,
    
    "S1",    "T2",     "Warm up",              2,
    "S1",    "T2",     "Lesson launch",        8,
    "S1",    "T2",     "Student group work",   20,
    "S1",    "T2",     "Class discussion",     13,
    "S1",    "T2",     "Transitions",          1,
    
    "S2",    "T1",     "Warm up",              8,
    "S2",    "T1",     "Lesson launch",        5,
    "S2",    "T1",     "Student group work",   14,
    "S2",    "T1",     "Class discussion",     4,  
    "S2",    "T1",     "Transitions",          7,
    
    "S3",    "T2",     "Warm up",              12,
    "S3",    "T2",     "Lesson launch",        11,
    "S3",    "T2",     "Student group work",   17,
    "S3",    "T2",     "Class discussion",     20,
    "S3",    "T2",     "Transitions",          4,
    
    "S3",    "T7",     "Warm up",              9,
    "S3",    "T7",     "Lesson launch",        10,
    "S3",    "T7",     "Student group work",   23,
    "S3",    "T7",     "Class discussion",     29,
    "S3",    "T7",     "Transitions",          4
  ) %>%
  mutate(
    act = act %>% fct_inorder() %>% fct_rev(),
    teacher = teacher %>% fct_inorder() %>% fct_rev()
  )
```


## Graphs by percentage duration

```{r}
df %>%
  group_by(school, teacher) %>%
  mutate(
   time = time / sum(time)
  ) %>%
  ungroup %>%
  ggplot(aes(teacher, time, fill = act)) +
  geom_col(position = "stack", color = "black") +
  scale_y_continuous(
    breaks = seq(0, 1, 0.2),
    minor_breaks = NULL,
    labels = scales::percent_format(accuracy = 1)
  ) +
  scale_fill_viridis_d() +
  guides(fill = guide_legend(reverse = T)) +
  theme_bw() +
  coord_flip() +
  facet_grid(vars(school), scales = "free_y") +
  labs(
    x = "Teacher",
    y = "Duration (%)",
    fill = "Activity"
  )
```



## Graphs by total duration

```{r}
df %>% 
  ggplot(aes(teacher, time, fill = act)) +
  geom_col(position = "stack", color = "black") +
  scale_fill_viridis_d() +
  guides(fill = guide_legend(reverse = T)) +
  scale_y_continuous(
    breaks = seq(0, 80, 10)
  ) +
  coord_flip() +
  theme_bw() +
  facet_grid(vars(school), scales = "free_y") +
  labs(
    x = "Teacher",
    y = "Duration (minutes)",
    fill = "Activity"
  )
```


